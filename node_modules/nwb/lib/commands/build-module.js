'use strict';

exports.__esModule = true;

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _fs = require('fs');

var _fs2 = _interopRequireDefault(_fs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _temp = require('temp');

var _temp2 = _interopRequireDefault(_temp);

var _debug = require('../debug');

var _debug2 = _interopRequireDefault(_debug);

var _exec = require('../exec');

var _exec2 = _interopRequireDefault(_exec);

var _getUserConfig = require('../getUserConfig');

var _getUserConfig2 = _interopRequireDefault(_getUserConfig);

exports['default'] = function (args) {
  require('./clean-module')(args);

  var es6 = _path2['default'].resolve('es6');
  var lib = _path2['default'].resolve('lib');
  var src = _path2['default'].resolve('src');

  var babelArgs = [src, '--out-dir', lib];

  // Write any user babel config to a temporary file to point babel at via the
  // babelrc option.
  var userConfig = _getUserConfig2['default'](args);
  if (userConfig.babel) {
    var babelrc = _temp2['default'].openSync();
    _debug2['default']('writing babelrc to %s', babelrc.path);
    _fs2['default'].writeSync(babelrc.fd, JSON.stringify(userConfig.babel));
    _fs2['default'].closeSync(babelrc.fd);
    babelArgs.push('--babelrc', babelrc.path);
  }

  console.log('nwb: build-module (es5)');
  _exec2['default']('babel', babelArgs);

  if (userConfig.build.jsNext) {
    babelArgs[2] = es6;
    babelArgs.push('--blacklist=es6.modules');
    console.log('nwb: build-module (es6)');
    _exec2['default']('babel', babelArgs);
  }

  _temp2['default'].cleanupSync();
};

module.exports = exports['default'];